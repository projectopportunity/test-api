/* eslint-env mocha */
'use strict'

const T = require('./index.js')
const CONNECTION_STRING = 'sqlite::memory:'

let instance

describe('the datastore module', () => {
  before(() => {
    instance = T()
    return instance.reset()
  })
 
  it('should have a property called "createUser"', () => {
    expect(instance).to.have.property('createUser')
  })
  
  describe('the "createUser" property', () => {
    it('should be a function', () => {
      const expected = 'function'
      const actual = typeof instance.createUser
      expect(actual).to.equal(expected)
    })

    describe('the returned value', () => {
      context('when the init method has not been called', () => {
        it('should be rejected', () => {
          const result = instance.createUser()
          return expect(result).to.be.rejectedWith('Please call init first')
        })
      })

      context('when the init method has been called', () => {
        let result

        before(async () => {
          await instance.init(CONNECTION_STRING)
          
          result = await instance.createUser({
            name: {
              first: 'create-user-first',
              last: 'create-user-last'
            },
            username: 'create-user-username',
            password: 'create-user-password'
          })
        })

        it('should be resolve to a number', () => {
          expect(result).to.be.a('number')
        })
      })
    })
  })
})