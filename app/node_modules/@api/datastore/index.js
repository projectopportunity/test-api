const { Sequelize } = require('sequelize')

class DataStore {
  async init (connectionString) {
    // Connection string for a Sqlite datbase
    // sqlite://C:/path/to/datbase/file

    const uri = new URL(connectionString)

    const sequelize = new Sequelize({
      dialect: uri.protocol.substr(0, uri.protocol.length - 1),
      storage: uri.pathname.substr(2)
    })

    await sequelize.authenticate()
  }

  createUser () {}
}

let sharedInstance = null

module.exports = () => {
  if (sharedInstance === null) {
    sharedInstance = new DataStore()
    return await sharedInstance.init()
  }

  return sharedInstance
}
