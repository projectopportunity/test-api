/* eslint-env mocha */
const { expect } = require('chai')
const T = require('./index.js')

describe('the datastore module', () => {
    it('should export a function', () => {
        const expected = 'function'
        const actual = typeof T
        expect(actual).to.equal(expected)
    })

    describe('the instance returned by the function', () => {
        it('should always refer to the same instance', () => {
            const expected = T()
            const actual = T()
            expect(actual).to.equal(expected)
        })

        it('should have a property called "createUser"', () => {
            const instance = T()
            expect(instance).to.have.property('createUser')
        })

        it('should have a property called "init"', () => {
            const instance = T()
            expect(instance).to.have.property('init')
        })

        describe('the "init" property', () => {
            let instance
            
            before(() => {
                instance = T()
            })
            
            it('should be a function', () => {
                const expected = 'function'
                const actual = typeof instance.init
                expect(actual).to.equal(expected)
            })

            it('should throw an error if param is missing', () => {
                const expected = 'the init method requires a connection string parameter'
                
                expect(() => {
                    instance.init()
                }).to.throw(expected)
            })

            it('should throw an error for invalid parameter values', () => {
                const expected = 'the init method requires a connection string parameter'
                const badValues = ['', 5, null]

                badValues.forEach((value) => {
                    expect(() => {
                        instance.init(value)
                    }).to.throw(expected)
                })
            })
        })
    })
})